
# ZIP
## 简介

ZIP文件格式是一种数据压缩和文档储存的文件格式，原名Deflate，发明者为菲尔·卡茨（Phil Katz），他于1989年1月公布了该格式的资料。ZIP通常使用后缀名“.zip”，它的MIME格式为`application/zip`。
## 结构

![](../../attachments/Pasted%20image%2020230804210215.png)
从上图我们可以看到，ZIP文件各组成部分之间是有对应关系的。数据存储区包含多个**文件实体**（File Entry）而一个被压缩的文件对应一个文件实体，一个文件实体又对应一个文件实体头。中心目录区包含多个文件头。
[ZIP文件结构解析 - 枫のBlog (goodapple.top)](https://goodapple.top/archives/700)

### 数据存储区

#### Local File Header (50 4B 03 04)
实体文件头中包含着文件的各种信息，包括文件名称、解压缩版本、压缩方式、CRC等等

#### File Data

文件数据从`66 6C`开始，一直到末尾的换行符`0A`。

#### Data descriptor (50 4B 07 08)

用于表示文件压缩结束，只有在文件实体头中通用标记位的第3Bit位为1时才会出现。一般zip上没有这个数据描述符，对应的编码格式如下。

### 中心目录区
中心目录区通常由多个文件头（File Header）组成。主要记录被压缩文件的目录结构，以及被压缩文件的属性，包括文件长度，压缩之后的长度，文件注释等。一个文件实体与一个文件头相对应。
#### FIle Header (50 4B 01 02)

文件头和实体文件头十分类似，它比实体文件头多记录了一些文件信息。
#### Digital Signature

通常由头标识`50 4B 05 05`开始

### 目录结束标识 (50 4B 05 06)

在中心目录区结束后，目录结束标识用于标记目录数据的结束，每个压缩文件有且只有一个。

## 隐写

### NTFS流隐写


## 加密

### 字典攻击

准备一些常用的简单密码字典，对于某些提示“简单”加密文件的可能有用。

### 暴力破解

#### 掩码攻击

只知道一部分明文，未知部分进行暴力。
如果使用`ARCHPR`工具，掩码长度有限制，这时候可以写脚本转换为字典攻击。

#### CRC爆破
如果里面存的数据很小（似乎小于10字节？要研究一下），可以采用它的CRC进行爆破直接得到数据明文。


### 伪加密

![](../../attachments/Pasted%20image%2020230709005551.png)
加密标志位是在`数据存储区`和`中心目录区`两块地方的`全局方式位标记(General purpose bit flag)`。
一般来说伪加密是中心目录区的标志位是奇数，而数据存储区的标志位是偶数
> PS: 但其实不一定，两个都是奇数的，所有工具都打不开，但是将第二蓝线手动修改成00又能够打开了。




