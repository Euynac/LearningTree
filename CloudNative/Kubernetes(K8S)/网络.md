# 网络

在 `K8S` 中，同一个命名空间（`namespace`）下的服务之间调用，之间通过服务名（`service name`）调用即可。不过在更多时候，我们可能会将一些服务单独隔离在一个命名空间中（比如我们将中间件服务统一放在 `middleware` 命名空间中，将业务服务放在 `business` 命名空间中）。

遇到这种情况，我们就需要跨命名空间访问，`K8S` 对 `service` 提供了四种不同的类型，针对这个问题我们选用 `ExternalName` 类型的 `service` 即可。

注意 `service` 端口是否开对

## DNS

> 1. k8s 中有 namespace 的概念，由于不同的 namespace 中可以有同样名称的 service or pod，因此 DNS 解析的部份就需要考虑 namespace
> 2. k8s cluster domain name，若是未设定，预设就会是 `cluster.local`

### 种类

#### Service DNS
基本格式：
`<service-name>.<namespace-name>.svc.<cluster domain name>`

#### Pod DNS
基本格式：
`<pod-ip-address>.<namespace-name>.pod.<cluster domain name>`

### 排查DNS问题

使用 `busybox` 镜像临时创建一个 `Pod` 并进入容器内部使用 `nslookup` 或 `ping` 等工具进行 DNS 测试。 

#### 将短暂容器设置为长时运行
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: busybox-sleep
spec:
  containers:
  - name: busybox
    image: busybox
    args: ["/bin/sh", "-c", "sleep 31536000"]  # 休眠一年
```

查看容器DNS：
1. 容器内部 `hostname`