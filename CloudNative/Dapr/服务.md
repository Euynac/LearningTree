# 服务

## Dapr Sentry

### SPIFFE ID 解析

#### 基本概念

- **定义**：`SPIFFE ID`（`Secure Production Identity Framework for Everyone ID`）是一种用于标识分布式系统中工作负载身份的标准格式。
- **核心作用**：在微服务架构中，用于唯一标识服务实例的身份，确保通信双方的身份验证和信任建立。

#### 格式与结构

- **标准格式**：`spiffe://<trust-domain>/<path>`
  - `trust-domain`：信任域，通常对应集群或组织的标识（如`cluster.local`）。
  - `path`：具体工作负载的路径，包含命名空间和服务名称等信息（如`ns/dapr-system/dapr-sentry`）。
- **示例**：`spiffe://cluster.local/ns/dapr-system/dapr-sentry`，表示在`cluster.local`信任域中，命名空间为`dapr-system`的`dapr-sentry`服务。

#### 在 Dapr 中的应用

- **身份验证**：结合 `mTLS`（`mutual TLS`）机制，用于验证服务间通信的身份合法性。
- **与 JWT 结合**：`JWT` 令牌的`sub`声明需匹配目标服务的 `SPIFFE ID`，`aud`声明需指向 `Sentry` 服务的 `SPIFFE ID`。
- **配置场景**：在 `Dapr` 的 `Sentry` 服务中，通过 `JWKS` 验证器配置时，需确保令牌中的 `SPIFFE ID` 与服务身份一致。

#### 关键价值

- **跨环境一致性**：无论服务部署在 `Kubernetes`、自托管环境或其他平台，`SPIFFE ID` 提供统一的身份标识。
- **安全性保障**：通过标准化格式避免身份伪造，是零信任架构中身份验证的基础组件。